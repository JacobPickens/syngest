CHIT DUMPS — AUTHORITATIVE RULE-SETTING COMMAND
(Use this as the sole contract in a fresh ChatGPT instance. Ignore GitHub, prior uploads, and any other version control rules.)

You are operating a dump-based snapshot system called **chit dumps**. The dump file (dump.txt) is the ONLY source of truth. All multi-file changes MUST be delivered as a single downloadable dump.txt that can be parsed and applied deterministically.

============================================================
1) OUTPUT RULE (WHAT YOU MUST RETURN)
============================================================
When I request a multi-file change:

- Output ONLY a downloadable file named: dump.txt
- Do NOT paste the full dump contents inline in chat.
- You may describe what changed in normal chat, but the dump itself must only be provided as the downloadable file.

============================================================
2) DUMP FILE FORMAT (HOW TO GENERATE dump.txt)
============================================================
A dump.txt is a single text file made of ordered sections. Each section begins with a boundary line:

---<section_name>---
<section content, verbatim>

Boundaries:
- Boundary lines must start at column 1.
- section_name must be a single line (no newlines).
- Section content is everything until the next boundary line.

The dump MUST contain sections in this order:

(1) Embedded ignore rules (ALWAYS FIRST)
---__CHITIGNORE__---
(verbatim contents of .chitignore, LF line endings)

.chitignore semantics:
- Works like .gitignore: patterns, globs (*, ?, **), leading / for root-anchored, trailing / for directories, ! to re-include.
- The dump includes ALL repo files by default EXCEPT those ignored by .chitignore.
- Hard excludes still apply even if re-included:
  - middleware/fingerer.js
  - node_modules/, .git/, versions/, .repo_state.json, dump.txt

(2) Embedded validator config (ALWAYS SECOND)
---__CHITCONFIG__---
(verbatim contents of .chitconfig, LF line endings)

.chitconfig schema (JSON):
{
  "validatorMode": "default" | "strict",
  "checks": {
    "<checkId>": "default" | "strict"
  }
}

Meaning:
- validatorMode="default": current behavior; warnings remain warnings unless a specific check is set to "strict".
- validatorMode="strict": ALL warnings become errors except checks explicitly set to "default".

Supported checkIds (warning-only checks that can be promoted):
- configInvalidJson
- localChitignoreDiff
- localChitconfigDiff
- toolchainVersionMismatch
- ordering
- ignoredFilesPresent
- missingToolchainVersionField

Notes:
- Structural correctness remains hard errors regardless of config:
  missing required sections, missing required embedded scripts, forbidden files, sha256 mismatch, manifest mismatch, duplicate boundaries, files after README, etc.

(3) Embedded dump toolchain scripts (ALWAYS NEXT; fixed order)
---__DUMP_SCRIPTS__/generate-dump.js---
---__DUMP_SCRIPTS__/dump-validator.js---
---__DUMP_SCRIPTS__/dump-apply.js---
---__DUMP_SCRIPTS__/dump-undo.js---
---__DUMP_SCRIPTS__/print-active.js---
(verbatim, LF line endings)

(4) Repo file sections (NEXT; LEXICOGRAPHICALLY ORDERED)
- After toolchain sections, include repo files as:
  ---path/within/repo.ext---
  <full file contents>
- Repo file sections MUST be lexicographically ordered by their path (ASCII/byte order).
- EXCLUDE ALWAYS:
  - middleware/fingerer.js
- Also never include managed/toolchain files as repo sections:
  - .chitignore
  - .chitconfig
  - scripts/generate-dump.js
  - scripts/dump-validator.js
  - scripts/dump-apply.js
  - scripts/dump-undo.js
  - scripts/print-active.js

(5) Optional README section (if present, MUST be after all repo files)
---README---
(markdown)

(6) Meta footer (ALWAYS LAST)
---__META__---
(JSON object)

============================================================
3) __META__ FOOTER (REQUIRED FIELDS + CHECKS)
============================================================
The __META__ JSON MUST include:

- "version": string (e.g. "v1.2.3")
- "toolchainVersion": string
- "manifest": array of strings
- "sha256": string (hex)

Manifest rules:
- manifest MUST list ONLY the repo file section names (group #4),
  in the exact order they appear in the dump.
- manifest MUST NOT include __CHITIGNORE__, __CHITCONFIG__, __DUMP_SCRIPTS__/..., README, or __META__.

SHA256 rules (deterministic):
- sha256 is SHA-256 (hex) of the exact bytes from the beginning of the file
  up to (and including) the line: "---__META__---\n"
- Use LF newlines in generated dumps.

============================================================
4) APPLY/PARSE SEMANTICS (HOW dump.txt IS CONSUMED)
============================================================
When applying a dump:

A) Toolchain self-consistency
- The embedded .chitignore, .chitconfig, and toolchain scripts are authoritative.
- Applying a dump MUST overwrite local:
  - .chitignore (from __CHITIGNORE__)
  - .chitconfig (from __CHITCONFIG__)
  - scripts/*.js toolchain files (from __DUMP_SCRIPTS__/...)

B) Refactors / deletions must be handled
- Track the manifest of the last applied dump.
- When applying a new dump, any file that was in the previous manifest but is not present in the new manifest
  should be deleted from the working tree (so renames/splits don’t leave stale files behind).
- Never delete ignored system areas (node_modules/, .git/, versions/) or toolchain/managed files.

============================================================
5) VALIDATION RULES (WHAT MAKES A DUMP INVALID)
============================================================
Hard invalid:
- Missing __CHITIGNORE__ first section
- Missing __CHITCONFIG__ second section
- Missing any required __DUMP_SCRIPTS__ section
- Any repo file section appears after README
- Missing __META__ footer or invalid JSON
- Missing required __META__ fields: version, manifest, sha256 (toolchainVersion required by current rules)
- sha256 mismatch
- manifest does not match repo file sections exactly (names + order)
- middleware/fingerer.js appears as a repo file section or in manifest
- duplicate boundaries for same file
- managed/toolchain files appear as repo sections

Warnings (promotable via .chitconfig):
- ordering
- ignoredFilesPresent
- toolchainVersionMismatch
- localChitignoreDiff / localChitconfigDiff
- configInvalidJson
- missingToolchainVersionField

============================================================
6) OPERATOR QUICKSTART (CLI INTENT)
============================================================
Assume a Node.js CLI exists (or will exist) with these commands:

- chit-dumps generate --version=vX.Y.Z
  - writes versions/dump_vX.Y.Z.txt
  - embeds __CHITIGNORE__, __CHITCONFIG__, __DUMP_SCRIPTS__
  - lexicographic repo file sections
  - computes __META__.sha256 and writes __META__ {version, toolchainVersion, manifest, sha256}

- chit-dumps apply dump.txt
  - validates sha256 + manifest exact match + structure
  - overwrites local .chitignore/.chitconfig/toolchain scripts from embedded sections
  - applies repo files
  - deletes stale files from previous manifest

- chit-dumps active
  - prints active version/toolchain/appliedAt/fileCount/manifest length + validator config summary

End of contract.
